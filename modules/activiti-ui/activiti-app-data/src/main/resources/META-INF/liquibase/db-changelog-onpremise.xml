<?xml version="1.0" encoding="UTF-8"?>
<databaseChangeLog xmlns="http://www.liquibase.org/xml/ns/dbchangelog"
	xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:ext="http://www.liquibase.org/xml/ns/dbchangelog-ext"
	xsi:schemaLocation="http://www.liquibase.org/xml/ns/dbchangelog http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-3.0.xsd
        http://www.liquibase.org/xml/ns/dbchangelog-ext http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-ext.xsd">

	<changeSet id="1" author="tijsrademakers">
    
        <!-- Hibernate sequence table -->
        <createTable tableName="hibernate_sequences">
            <column name="sequence_name" type="varchar(255)" />
            <column name="sequence_next_hi_value" type="integer" />
        </createTable>
        
        <!-- User, authority and tokens -->
		<createTable tableName="USERS">
			<column name="id" type="bigint">
				<constraints primaryKey="true" nullable="false" />
			</column>
			<column name="pass_word" type="varchar(100)" />
			<column name="first_name" type="varchar(50)" />
			<column name="last_name" type="varchar(50)" />
			<column name="email" type="varchar(100)" />
			<column name="company" type="varchar(100)"/>
            <column name="created" type="datetime(6)" />
            <column name="status" type="smallint" />
            <column name="account_type" type="smallint" defaultValueNumeric="1" />
            <column name="tenant_id" type="bigint" />
            <column name="manager_user_id" type="bigint" />
            <column name="picture_image_id" type="bigint" /> 
            <column name="last_update" type="timestamp(6)" />
            <column name="external_id" type="varchar(2000)" />
            <column name="last_sync_timestamp" type="timestamp(6)" />
            <column name="last_sync_timestamp_epoch" type="bigint" />
		</createTable>
            
        <!-- Adding index on user email, since that is used for every login. -->
        <createIndex indexName="idx_user_email" tableName="USERS" unique="false">
            <column name="email" />
        </createIndex>
        
        <!-- Adding index on last updated. Used a lot in checking if user is still valid. -->
        <createIndex indexName="idx_user_lastupdate" tableName="USERS" unique="false">
            <column name="last_update" />
        </createIndex>
        
        <!-- Group = set of capabilities. Part of a tenant.  -->
        <createTable tableName="GROUPS"> <!-- group is a reserved keyword, hence the plural -->
            <column name="id" type="bigint">
                <constraints primaryKey="true" nullable="false" />
            </column>
            <column name="name" type="varchar(255)">
                <constraints nullable="false"/>           
            </column>
            <column name="tenant_id" type="bigint" />
            <column name="group_type" type="integer" defaultValueNumeric="0" />
            <column name="parent_group_id" type="bigint" />
            <column name="last_update" type="timestamp(6)" valueDate="2010-05-17" />
            <column name="external_id" type="varchar(2000)" />
            <column name="last_sync_timestamp" type="timestamp(6)" />
            <column name="last_sync_timestamp_epoch" type="bigint" /> <!-- Also storing the last sync timestamp as long, for db compatibility -->
            
            <!-- Allow for soft delete of group -->
            <column name="status" type="smallint" />
        </createTable>
        
        <createTable tableName="USER_GROUP">
             <column name="user_id" type="bigint" />
             <column name="group_id" type="bigint" />   
        </createTable>
        
        <!-- Capability mapping to groups -->   
        <createTable tableName="GROUP_CAPABILITY">
            <column name="id" type="bigint">
                <constraints primaryKey="true" nullable="false" />
            </column>
             <column name="group_id" type="bigint" />
             <column name="name" type="varchar(255)">
                <constraints nullable="false"/>          
             </column>  
        </createTable>
        
        <createTable tableName="TENANT_EVENT">
            <column name="id" type="bigint">
                <constraints primaryKey="true" nullable="false" />
            </column>
            <column name="tenant_id" type="bigint" />
            <column name="event_type" type="varchar(255)"/>
            <column name="extra_info" type="varchar(4000)"/>
            <column name="event_time" type="timestamp(6)"/>
            <column name="user_id" type="bigint" /> 
            <column name="user_name" type="varchar(255)" />
        </createTable>
            
        <createIndex tableName="TENANT_EVENT"
            indexName="idx_tenant_event_createtime">
            <column name="event_time" />
        </createIndex>

		<createTable tableName="AUTHORITY">
			<column name="name" type="varchar(255)">
				<constraints primaryKey="true" nullable="false" />
			</column>
		</createTable>

		<createTable tableName="USER_AUTHORITY">
			<column name="user_id" type="bigint">
			  <constraints nullable="false"/>          
            </column>
			<column name="name" type="varchar(255)">
			  <constraints nullable="false"/>          
            </column>
		</createTable>

		<createTable tableName="PERSISTENT_TOKEN">
            <column name="series" type="varchar(255)">
                <constraints primaryKey="true" nullable="false"/>
            </column>
            <column name="user_id" type="bigint"/>
            <column name="token_value" type="varchar(255)"/>
            <column name="token_date" type="date"/>
            <column name="ip_address" type="varchar(39)"/>
            <column name="user_agent" type="varchar(255)"/>
        </createTable>
        
        <createIndex indexName="idx_user_authority" tableName="USER_AUTHORITY" unique="true">
            <column name="user_id" />
            <column name="name" />
        </createIndex>

        <!-- model -->
		<createTable tableName="MODEL">
			<column name="id" type="bigint">
				<constraints primaryKey="true" nullable="false" />
			</column>
			<column name="name" type="varchar(400)">
				<constraints nullable="false" />
			</column>
			<column name="description" type="varchar(4000)">
				<constraints nullable="true" />
			</column>
			<column name="model_comment" type="varchar(4000)">
				<constraints nullable="true" />
			</column>
			<column name="created" type="datetime(6)">
				<constraints nullable="true" />
			</column>
			<column name="created_by" type="bigint">
				<constraints nullable="true" />
			</column>
			<column name="last_updated" type="datetime(6)">
				<constraints nullable="true" />
			</column>
			<column name="last_updated_by" type="bigint">
				<constraints nullable="true" />
			</column>
			<column name="version" type="int">
				<constraints nullable="true" />
			</column>
			<column name="stencil_set_id" type="bigint">
                <constraints nullable="true" />
            </column>
			<column name="model_editor_json" type="longtext">
				<constraints nullable="true" />
			</column>
			<column name="thumbnail" type="longblob">
				<constraints nullable="true" />
			</column>
			<column name="model_type" type="int">
                <constraints nullable="true" />
            </column>
            <column name="reference_id" type="bigint">
                <constraints nullable="true" />
            </column>
		</createTable>
        
        <createIndex indexName="idx_proc_mod_created"
            tableName="MODEL" unique="false">
            <column name="created_by" />
        </createIndex>
        
        <createTable tableName="FORM">
            <column name="id" type="bigint">
                <constraints primaryKey="true" nullable="false" />
            </column>
            <column name="name" type="varchar(255)">
                <constraints nullable="false" />
            </column>
            <column name="description" type="varchar(4000)" />
            <column name="created" type="timestamp(6)">
                <constraints nullable="true" />
            </column>
            <column name="form_definition" type="longtext" />
            <column name="created_by" type="bigint">
                <constraints nullable="true" />
            </column>
            <column name="model_id" type="bigint">
                <constraints nullable="true" />
            </column>
            <column name="app_definition_id" type="bigint">
                <constraints nullable="true" />
            </column>
            <column name="app_deployment_id" type="bigint">
                <constraints nullable="true" />
            </column>
        </createTable>
        
        <!-- Model history -->
        <createTable tableName="MODEL_HISTORY">
            <column name="id" type="bigint">
                <constraints primaryKey="true" nullable="false" />
            </column>
            <column name="name" type="varchar(400)">
                <constraints nullable="false" />
            </column>
            <column name="description" type="varchar(4000)">
                <constraints nullable="true" />
            </column>
            <column name="model_comment" type="varchar(4000)">
                <constraints nullable="true" />
            </column>
            <column name="created" type="datetime(6)">
                <constraints nullable="true" />
            </column>
            <column name="created_by" type="bigint">
                <constraints nullable="true" />
            </column>
            <column name="last_updated" type="datetime(6)">
                <constraints nullable="true" />
            </column>
            <column name="last_updated_by" type="bigint">
                <constraints nullable="true" />
            </column>
            <column name="removal_date" type="datetime(6)">
                <constraints nullable="true" />
            </column>
            <column name="version" type="int">
                <constraints nullable="true" />
            </column>
            <column name="stencil_set_id" type="bigint">
                <constraints nullable="true" />
            </column>
            <column name="model_editor_json" type="longtext">
                <constraints nullable="true" />
            </column>
            <column name="model_id" type="bigint">
                <constraints nullable="false" />
            </column>
            <column name="model_type" type="int">
                <constraints nullable="true" />
            </column>
            <column name="reference_id" type="bigint">
                <constraints nullable="true" />
            </column>
        </createTable>
        
        <createIndex indexName="idx_proc_mod_history_proc"
            tableName="MODEL_HISTORY" unique="false">
            <column name="model_id" />
        </createIndex>
        
        <createTable tableName="STENCIL_SET">
            <column name="id" type="bigint">
                <constraints primaryKey="true" nullable="false" />
            </column>
            <column name="name" type="varchar(255)">
                <constraints nullable="false" />
            </column>
            <column name="description" type="varchar(4000)">
                <constraints nullable="true" />
            </column>
            <column name="created" type="datetime(6)">
                <constraints nullable="false" />
            </column>
            <column name="stencil_type" type="int">
                <constraints nullable="false" />
            </column>
            <column name="default_stencil_set" type="boolean">
                <constraints nullable="false" />
            </column>
            <column name="version" type="int">
                <constraints nullable="false" />
            </column>
            <column name="content_type" type="varchar(255)">
                <constraints nullable="false" />
            </column>
            <column name="user_id" type="bigint">
                <constraints nullable="false" />
            </column>
            <column name="stencil_set_json" type="longblob">
                <constraints nullable="false" />
            </column>
            <column name="last_updated" type="datetime(6)">
                <constraints nullable="true" />
            </column>
            <column name="last_updated_by" type="bigint">
                <constraints nullable="true" />
            </column>
            <column name="model_comment" type="varchar(4000)">
                <constraints nullable="true" />
            </column>
        </createTable>
        
        <createTable tableName="STENCIL_SET_HISTORY">
            <column name="id" type="bigint">
                <constraints primaryKey="true" nullable="false" />
            </column>
            <column name="name" type="varchar(255)">
                <constraints nullable="false" />
            </column>
            <column name="description" type="varchar(4000)">
                <constraints nullable="true" />
            </column>
            <column name="created" type="datetime(6)">
                <constraints nullable="false" />
            </column>
            <column name="last_updated" type="datetime(6)">
                <constraints nullable="true" />
            </column>
            <column name="stencil_type" type="int">
                <constraints nullable="false" />
            </column>
            <column name="default_stencil_set" type="boolean">
                <constraints nullable="false" />
            </column>
            <column name="version" type="int">
                <constraints nullable="false" />
            </column>
            <column name="content_type" type="varchar(255)">
                <constraints nullable="false" />
            </column>
            <column name="user_id" type="bigint">
                <constraints nullable="false" />
            </column>
            <column name="last_updated_by" type="bigint">
                <constraints nullable="true" />
            </column>
            <column name="stencil_set_json" type="longblob">
                <constraints nullable="false" />
            </column>
            <column name="model_comment" type="varchar(4000)">
                <constraints nullable="true" />
            </column>
            <column name="stencil_set_id" type="bigint">
                <constraints nullable="false" />
            </column>
        </createTable>
        
        <!-- Stencil set sharing -->
        <createTable tableName="STENCIL_SET_SHARE_INFO">
            <column name="id" type="bigint">
                <constraints primaryKey="true" nullable="false" />
            </column>
            <column name="user_id" type="bigint">
                <constraints nullable="true" />
            </column>
            <column name="email" type="varchar(100)">
                <constraints nullable="true" />
            </column>
            <column name="shared_by" type="bigint">
                <constraints nullable="false" />
            </column>
            <column name="stencil_set_id" type="bigint">
                <constraints nullable="false" />
            </column>
            <column name="share_date" type="datetime">
                <constraints nullable="false" />
            </column>
            <column name="permission" type="smallint">
                <constraints nullable="true" />
            </column>
        </createTable>
    
        <createIndex indexName="idx_stencil_set_share_user"
            tableName="STENCIL_SET_SHARE_INFO" unique="false">
            <column name="user_id" />
        </createIndex>
        <createIndex indexName="idx_stencil_set_share_by_user"
            tableName="STENCIL_SET_SHARE_INFO" unique="false">
            <column name="shared_by" />
        </createIndex>
        <createIndex indexName="idx_stencil_set_share_process"
            tableName="STENCIL_SET_SHARE_INFO" unique="false">
            <column name="stencil_set_id" />
        </createIndex>
        
        <!-- Favorite --> 
        <createTable tableName="STENCIL_SET_USER_FAVORITE">
            <column name="id" type="bigint">
                <constraints primaryKey="true" nullable="false" />
            </column>
            <column name="user_id" type="bigint">
                <constraints nullable="false"/>
            </column>
            <column name="stencil_set_id" type="bigint">
                <constraints nullable="false"/>
            </column>
        </createTable>
        
        <createIndex indexName="idx_stencil_user_favorite_id"
            tableName="STENCIL_SET_USER_FAVORITE" unique="false">
            <column name="user_id" />
        </createIndex>
            
        <!-- Comments -->
        <createTable tableName="STENCIL_SET_COMMENT">
            <column name="id" type="bigint">
                <constraints primaryKey="true" nullable="false" />
            </column>
            <column name="message" type="varchar(4000)">
                <constraints nullable="false" />
            </column>
            <column name="comment_date" type="datetime">
                <constraints nullable="false" />
            </column>
            <column name="user_id" type="bigint">
                <constraints nullable="false" />
            </column>
            <column name="stencil_set_id" type="bigint">
                <constraints nullable="false" />
            </column>
        </createTable>
        
        <createIndex indexName="idx_stencil_comment_stencilset"
            tableName="STENCIL_SET_COMMENT" unique="false">
            <column name="stencil_set_id" />
            <column name="comment_date" />
        </createIndex>

        <!-- Favorite --> 
        <createTable tableName="USER_FAVORITE">
            <column name="id" type="bigint">
                <constraints primaryKey="true" nullable="false" />
            </column>
            <column name="user_id" type="bigint">
                <constraints nullable="false"/>
            </column>
            <column name="model_id" type="bigint">
                <constraints nullable="false"/>
            </column>
        </createTable>
        
        <createIndex indexName="idx_user_favorite_id"
            tableName="USER_FAVORITE" unique="false">
            <column name="user_id" />
        </createIndex>
            
        <!-- Process sharing -->
        <createTable tableName="MODEL_SHARE_INFO">
            <column name="id" type="bigint">
                <constraints primaryKey="true" nullable="false" />
            </column>
            <column name="user_id" type="bigint">
                <constraints nullable="true" />
            </column>
            <column name="email" type="varchar(100)">
                <constraints nullable="true" />
            </column>
            <column name="shared_by" type="bigint">
                <constraints nullable="false" />
            </column>
            <column name="model_id" type="bigint">
                <constraints nullable="false" />
            </column>
            <column name="share_date" type="datetime(6)">
                <constraints nullable="false" />
            </column>
            <column name="permission" type="smallint">
                <constraints nullable="true" />
            </column>
        </createTable>
    
        <createIndex indexName="idx_proc_mod_share_user"
            tableName="MODEL_SHARE_INFO" unique="false">
            <column name="user_id" />
        </createIndex>
        <createIndex indexName="idx_proc_mod_share_by_user"
            tableName="MODEL_SHARE_INFO" unique="false">
            <column name="shared_by" />
        </createIndex>
    
        <createIndex indexName="idx_proc_mod_share_process"
            tableName="MODEL_SHARE_INFO" unique="false">
            <column name="model_id" />
        </createIndex>
        
        <!-- Comments -->
        <createTable tableName="MODEL_COMMENT">
            <column name="id" type="bigint">
                <constraints primaryKey="true" nullable="false" />
            </column>
            <column name="message" type="varchar(4000)">
                <constraints nullable="false" />
            </column>
            <column name="comment_date" type="datetime(6)">
                <constraints nullable="false" />
            </column>
            <column name="user_id" type="bigint">
                <constraints nullable="false" />
            </column>
            <column name="model_id" type="bigint">
                <constraints nullable="false" />
            </column>
        </createTable>
            
        <createIndex indexName="idx_proc_mod_comment_process"
            tableName="MODEL_COMMENT" unique="false">
            <column name="model_id" />
            <column name="comment_date" />
        </createIndex>
        
        <!-- Email actions -->        
        <createTable tableName="EMAIL_ACTION">
            <column name="id" type="bigint">
                <constraints primaryKey="true" nullable="false" />
            </column>
            <column name="secret" type="varchar(256)">
                <constraints nullable="false" />
            </column>
            <column name="created" type="datetime(6)">
                <constraints nullable="true" />
            </column>
            <column name="expires" type="datetime(6)">
                <constraints nullable="true" />
            </column>
            <column name="user_id" type="bigint">
                <constraints nullable="false" />
            </column>
            <column name="action_type" type="smallint">
                <constraints nullable="true" />
            </column>
        </createTable>
            
        <createTable tableName="IMAGE_UPLOAD">
            <column name="id" type="bigint">
                <constraints primaryKey="true" nullable="false" />
            </column>
            <column name="name" type="varchar(255)">
                <constraints nullable="false" />
            </column>
            <column name="image" type="longblob">
                <constraints nullable="false" />
            </column>
            <column name="user_id" type="bigint">
                <constraints nullable="false" />
            </column>
            <column name="created" type="datetime(6)">
                <constraints nullable="false" />
            </column>
        </createTable>
        
        <createTable tableName="COMMENTS">
            <column name="id" type="bigint">
                <constraints primaryKey="true" nullable="false" />
            </column>
            <column name="message" type="varchar(4000)">
                <constraints nullable="false"/>
            </column>
            <column name="created" type="timestamp(6)" />
            <column name="created_by" type="bigint" /> 
            <column name="task_id" type="varchar(255)" /> 
            <column name="proc_inst_id" type="varchar(255)" /> 
             
            <column name="comment_definition" type="longtext" />
        </createTable>
        
        <createIndex tableName="COMMENTS" indexName="comment_task_created">
            <column name="task_id" />
            <column name="created" />
        </createIndex>
        
        <createIndex tableName="COMMENTS" indexName="comment_proc_created">
            <column name="proc_inst_id" />
            <column name="created" />
        </createIndex>
        
        <createTable tableName="RELATED_CONTENT">
            <column name="id" type="bigint">
                <constraints primaryKey="true" nullable="false" />
            </column>
            <column name="name" type="varchar(255)">
                <constraints nullable="false" />
            </column>
            <column name="created" type="timestamp(6)" />
            <column name="created_by" type="bigint" />
            
            <column name="task_id" type="varchar(255)">
                <constraints nullable="true"/>
            </column>
            <column name="process_id" type="varchar(255)">
                <constraints nullable="true"/>
            </column>
            <column name="content_source" type="varchar(255)">
                <constraints nullable="true" />
            </column>
            <column name="source_id" type="varchar(4000)">
                <constraints nullable="true" />
            </column>
            <column name="store_id" type="varchar(255)"/>
            <column name="mime_type" type="varchar(255)">
                <constraints nullable="true" />
            </column>
            <column name="field" type="varchar(400)">
                <constraints nullable="true" />
            </column>
            <column name="related_content" type="boolean">
                <constraints nullable="false" />
            </column>
            <column name="link" type="boolean">
                <constraints nullable="false" />
            </column>
            <column name="link_url" type="varchar(4000)">
                <constraints nullable="true" />
            </column>
            <column name="preview_status" type="smallint" />
            <column name="thumbnail_status" type="smallint" />
            <column name="content_available" type="boolean" defaultValueBoolean="false" />
            <column name="locked" type="boolean" defaultValueBoolean="false" />
            <column name="lock_date" type="timestamp(6)" />
            <column name="lock_exp_date" type="timestamp(6)" />
            <column name="lock_owner" type="bigint" />
            <column name="checked_out" type="boolean" defaultValueBoolean="false" />
            <column name="checkout_date" type="timestamp(6)" />
            <column name="checkout_owner" type="bigint" />
            <column name="last_modified" type="timestamp(6)" />
            <column name="last_modified_by" type="bigint" />
            <column name="checked_out_to_local" type="boolean" defaultValueBoolean="false" />
            <column name="temporary" type="boolean" defaultValueBoolean="false" />
            <column name="content_size" type="bigint" defaultValueNumeric="0" />
        </createTable>
            
        <createIndex tableName="RELATED_CONTENT" indexName="idx_relcont_createdby">
            <column name="created_by" />
        </createIndex>
        <createIndex tableName="RELATED_CONTENT" indexName="idx_relcont_taskid">
            <column name="task_id" />
        </createIndex>
        <createIndex tableName="RELATED_CONTENT" indexName="idx_relcont_procid">
            <column name="process_id" />
        </createIndex>
        
        <createTable tableName="USER_ACCOUNT">
            <column name="id" type="bigint">
                <constraints primaryKey="true" nullable="false" />
            </column>
            <column name="service_id" type="varchar(255)">
                <constraints nullable="false" />
            </column>
            <column name="owner" type="bigint" />
            <column name="expiry_date" type="timestamp(6)" />
            <column name="access_token" type="varchar(255)">
                <constraints nullable="true"/>
            </column>
            <column name="refresh_token" type="varchar(255)">
                <constraints nullable="true"/>
            </column>
            <column name="username" type="varchar(4000)">
                 <constraints nullable="true" />
            </column>
            <column name="account_password" type="varchar(4000)">
                 <constraints nullable="true" />
            </column>
        </createTable>
        
         <createIndex tableName="USER_ACCOUNT" indexName="idx_useracc_serv_own">
            <column name="service_id" />
            <column name="owner" />
        </createIndex>
        
        <createTable tableName="REPORT_DEFINITION">
             <column name="id" type="bigint">
                <constraints primaryKey="true" nullable="false" />
            </column>
            <column name="name" type="varchar(255)">
                <constraints nullable="false" />
            </column>
            <column name="user_id" type="bigint"></column>
            <column name="description" type="varchar(4000)" />
            <column name="created" type="timestamp(6)">
                <constraints nullable="true" />
            </column>
            <column name="report_generator_id" type="varchar(1024)">
                <constraints nullable="true"/>
            </column>
            <column name="report_type" type="varchar(255)" />
            <column name="saved_params" type="longtext" />
        </createTable>
            
        <createTable tableName="PROCESSED_ACTIVITI_EVENTS">
            <column name="LOG_NR_" type="bigint">
                <constraints primaryKey="true" nullable="false" />
            </column>
            <column name="TYPE_" type="varchar(64)">
                <constraints nullable="false" />
            </column>
            <column name="PROC_DEF_ID_" type="varchar(64)" />
            <column name="PROC_INST_ID_" type="varchar(64)" />
            <column name="EXECUTION_ID_" type="varchar(64)" />  
            <column name="TASK_ID_" type="varchar(64)" />  
            <column name="TIME_STAMP_" type="datetime(3)">
                <constraints nullable="false"/>         
            </column>        
            <column name="USER_ID_" type="varchar(255)" />
            <column name="DATA_" type="longtext" />
        </createTable>
        
        <!-- Tenant  -->
        <createTable tableName="TENANT">
            <column name="id" type="bigint">
                <constraints primaryKey="true" nullable="false" />
            </column>
            <column name="name" type="varchar(255)">
                <constraints nullable="false"/>           
            </column>
            <column name="created" type="timestamp(6)" />
            <column name="last_update" type="timestamp(6)" />
            <column name="logo_image_id" type="bigint" />
            <column name="domain" type="varchar(255)" />
            <column name="active_tenant" type="boolean" defaultValueBoolean="false" />
            <column name="max_users" type="integer" />
        </createTable>
            
        <createTable tableName="RUNTIME_APP_DEF">
            <column name="id" type="bigint">
                <constraints primaryKey="true" nullable="false" />
            </column>
            <column name="name" type="varchar(400)">
                <constraints nullable="false" />
            </column>
            <column name="description" type="varchar(4000)">
                <constraints nullable="true" />
            </column>
            <column name="created" type="datetime">
                <constraints nullable="true" />
            </column>
            <column name="created_by" type="bigint">
                <constraints nullable="true" />
            </column>
            <column name="model_id" type="bigint">
                <constraints nullable="false" />
            </column>
            <column name="deployment_id" type="varchar(400)">
                <constraints nullable="true" />
            </column>
            <column name="app_definition" type="longtext">
                <constraints nullable="true" />
            </column>
        </createTable>
        
        <!-- Added to prevent duplicate deployment of a single model by multiple users at the same time -->
        <addUniqueConstraint columnNames="model_id"
            constraintName="uniq_runtime_app_def_model"
            tableName="RUNTIME_APP_DEF" />
            
         <createTable tableName="RUNTIME_APP">
            <column name="id" type="bigint">
                <constraints primaryKey="true" nullable="false" />
            </column>
            <column name="app_definition" type="bigint">
                <constraints nullable="false" />
            </column>
            <column name="app_user" type="bigint">
                <constraints nullable="false" />
            </column>
        </createTable>
        
        <createIndex indexName="idx_runtime_app_user"
            tableName="RUNTIME_APP" unique="false">
            <column name="app_user" />
        </createIndex>
        <createIndex indexName="idx_runtime_app_def"
            tableName="RUNTIME_APP" unique="false">
            <column name="app_definition" />
        </createIndex>
        
        <createTable tableName="RUNTIME_APP_DEPLOYMENT">
            <column name="id" type="bigint">
                <constraints primaryKey="true" nullable="false" />
            </column>
            <column name="app_id" type="bigint">
                <constraints nullable="true" />
            </column>
            <column name="created" type="datetime">
                <constraints nullable="true" />
            </column>
            <column name="created_by" type="bigint">
                <constraints nullable="true" />
            </column>
            <column name="model_id" type="bigint">
                <constraints nullable="true" />
            </column>
            <column name="deployment_id" type="varchar(400)">
                <constraints nullable="true" />
            </column>
            <column name="app_definition" type="longtext">
                <constraints nullable="true" />
            </column>
        </createTable>
        
        <createTable tableName="CONTENT_RENDITION">
            <column name="id" type="bigint">
                <constraints primaryKey="true" nullable="false" />
            </column>
            <column name="content_id" type="bigint">
                <constraints nullable="false" />
            </column>
            <column name="queued" type="timestamp(6)" />
            <column name="processing_started" type="timestamp(6)" />
            <column name="created" type="timestamp(6)" />
            <column name="status" type="smallint" />
            <column name="rendition_type" type="varchar(255)">
                <constraints nullable="false" />
            </column>
             <column name="store_id" type="varchar(255)">
                <constraints nullable="true" />
            </column>
        </createTable>
            
        <createIndex tableName="CONTENT_RENDITION" indexName="idx_cont_rend_content">
            <column name="content_id" />
        </createIndex>
        
        <addUniqueConstraint
            tableName="CONTENT_RENDITION"
            columnNames="content_id, rendition_type"
            constraintName="uniq_cont_rend_cont_type"/>
            
        <createTable tableName="SUBMITTED_FORM">
            <column name="id" type="bigint">
                <constraints primaryKey="true" nullable="false" />
            </column>
            <column name="form_id" type="bigint">
                <constraints nullable="true" />
            </column>
            <column name="task_id" type="varchar(255)">
                <constraints nullable="true" />
            </column>
            <column name="process_id" type="varchar(255)">
                <constraints nullable="true" />
            </column>
            <column name="submitted" type="timestamp(6)" />
            <column name="submitted_by" type="bigint">
                <constraints nullable="true" />
            </column>
            <column name="fields_value_definition" type="longtext">
                <constraints nullable="true" />
            </column>
        </createTable>
        
        <createIndex indexName="idx_submittedform_form_id"
            tableName="SUBMITTED_FORM" unique="false">
            <column name="form_id" />
        </createIndex>
        
        <createIndex indexName="idx_submittedform_task_id"
            tableName="SUBMITTED_FORM" unique="false">
            <column name="task_id" />
        </createIndex>
        
        <createTable tableName="ALFRESCO_ENDPOINT">
            <column name="id" type="bigint">
                <constraints primaryKey="true" nullable="false" />
            </column>
            <column name="tenant_id" type="bigint">
                <constraints nullable="false" />
            </column>
            <column name="created" type="timestamp(6)" />
            <column name="last_updated" type="timestamp(6)" />
            <column name="alf_tenant_id" type="varchar(255)">
                 <constraints nullable="true" />
            </column>
            <column name="alf_repo_url" type="varchar(4000)">
                 <constraints nullable="true" />
            </column>
            <column name="alf_share_url" type="varchar(4000)">
                 <constraints nullable="true" />
            </column>
            <column name="name" type="varchar(255)">
                 <constraints nullable="false" />
            </column>
            <column name="deleted" type="timestamp(6)" />
        </createTable>
        
        <createTable tableName="IDM_SYNC_LOG">
            <column name="id" type="bigint">
                <constraints primaryKey="true" nullable="false" />
            </column>
            <column name="sync_type" type="varchar(255)">
                <constraints nullable="false"/>
            </column>
            <column name="time_stamp" type="timestamp(6)" />
            <column name="info" type="longtext" />
        </createTable>
        
        <createIndex indexName="idx_alf_endpoint_tenant_id"
            tableName="ALFRESCO_ENDPOINT" unique="false">
            <column name="tenant_id" />
        </createIndex>
        
        <addForeignKeyConstraint baseColumnNames="user_id"
            baseTableName="USER_GROUP" 
            constraintName="fk_user_group_user"
            referencedColumnNames="id" 
            referencedTableName="USERS" />  
            
        <addForeignKeyConstraint baseColumnNames="group_id"
            baseTableName="USER_GROUP" 
            constraintName="fk_user_group_group"
            referencedColumnNames="id" 
            referencedTableName="GROUPS" />
            
        <addForeignKeyConstraint baseColumnNames="model_id"
            baseTableName="MODEL_COMMENT" constraintName="fk_proc_mod_comment_proc"
            referencedColumnNames="id" referencedTableName="MODEL" />
        
        <addForeignKeyConstraint baseColumnNames="user_id"
            baseTableName="MODEL_COMMENT" constraintName="fk_proc_mod_comment_user"
            referencedColumnNames="id" referencedTableName="USERS" />
            
        <addForeignKeyConstraint baseColumnNames="user_id"
            baseTableName="USER_FAVORITE" constraintName="fk_user_favorite_id"
            referencedColumnNames="id" referencedTableName="USERS" />
            
        <addForeignKeyConstraint baseColumnNames="model_id"
            baseTableName="USER_FAVORITE" constraintName="fk_user_favorite_process"
            referencedColumnNames="id" referencedTableName="MODEL" />
         
        <addForeignKeyConstraint baseColumnNames="stencil_set_id"
            baseTableName="STENCIL_SET_COMMENT" constraintName="fk_stencil_comment_stencilset"
            referencedColumnNames="id" referencedTableName="STENCIL_SET" />
        
        <addForeignKeyConstraint baseColumnNames="user_id"
            baseTableName="STENCIL_SET_COMMENT" constraintName="fk_stencil_comment_user"
            referencedColumnNames="id" referencedTableName="USERS" />
            
        <addForeignKeyConstraint baseColumnNames="user_id"
            baseTableName="STENCIL_SET_SHARE_INFO" constraintName="fk_stencil_set_share_user"
            referencedColumnNames="id" referencedTableName="USERS" />
            
        <addForeignKeyConstraint baseColumnNames="shared_by"
            baseTableName="STENCIL_SET_SHARE_INFO" constraintName="fk_stencil_set_share_by_user"
            referencedColumnNames="id" referencedTableName="USERS" />
    
        <addForeignKeyConstraint baseColumnNames="stencil_set_id"
            baseTableName="STENCIL_SET_SHARE_INFO" constraintName="fk_stencil_set_share_stencil"
            referencedColumnNames="id" referencedTableName="STENCIL_SET" />
            
        <addForeignKeyConstraint baseColumnNames="user_id"
            baseTableName="MODEL_SHARE_INFO" constraintName="fk_proc_mod_share_user"
            referencedColumnNames="id" referencedTableName="USERS" />
            
        <addForeignKeyConstraint baseColumnNames="shared_by"
            baseTableName="MODEL_SHARE_INFO" constraintName="fk_proc_mod_share_by_user"
            referencedColumnNames="id" referencedTableName="USERS" />
    
        <addForeignKeyConstraint baseColumnNames="model_id"
            baseTableName="MODEL_SHARE_INFO" constraintName="fk_proc_mod_share_proc"
            referencedColumnNames="id" referencedTableName="MODEL" />
        
        <addForeignKeyConstraint baseColumnNames="tenant_id"
            baseTableName="USERS" 
            constraintName="fk_user_tenant"
            referencedColumnNames="id" 
            referencedTableName="TENANT" />
            
        <addForeignKeyConstraint baseColumnNames="manager_user_id"
            baseTableName="USERS" 
            constraintName="fk_user_manager"
            referencedColumnNames="id" 
            referencedTableName="USERS" />
            
        <addForeignKeyConstraint baseColumnNames="picture_image_id"
            baseTableName="USERS" 
            constraintName="fk_user_picture"
            referencedColumnNames="id" 
            referencedTableName="IMAGE_UPLOAD" />
            
        <addForeignKeyConstraint baseColumnNames="tenant_id"
            baseTableName="GROUPS" 
            constraintName="fk_group_tenant"
            referencedColumnNames="id" 
            referencedTableName="TENANT" />
        
        <addForeignKeyConstraint baseColumnNames="parent_group_id"
            baseTableName="GROUPS" 
            constraintName="fk_parent_group"
            referencedColumnNames="id" 
            referencedTableName="GROUPS" />
            
        <addForeignKeyConstraint baseColumnNames="name"
            baseTableName="USER_AUTHORITY" constraintName="fk_authority_name"
            referencedColumnNames="name" referencedTableName="AUTHORITY" />

        <addForeignKeyConstraint baseColumnNames="user_id"
            baseTableName="USER_AUTHORITY" 
            constraintName="fk_user_id"
            referencedColumnNames="id" 
            referencedTableName="USERS" />

        <addForeignKeyConstraint baseColumnNames="user_id"
            baseTableName="PERSISTENT_TOKEN"
            constraintName="fk_user_persistent_token"
            referencedColumnNames="id"
            referencedTableName="USERS"/>
                                 
        <addForeignKeyConstraint baseColumnNames="logo_image_id"
            baseTableName="TENANT" 
            constraintName="fk_tenant_logo"
            referencedColumnNames="id" 
            referencedTableName="IMAGE_UPLOAD" />
            
        <addForeignKeyConstraint baseColumnNames="user_id"
            baseTableName="EMAIL_ACTION" constraintName="fk_email_action_user"
            referencedColumnNames="id" referencedTableName="USERS" />
        
        <addForeignKeyConstraint baseColumnNames="tenant_id"
            baseTableName="ALFRESCO_ENDPOINT" constraintName="fk_alf_endpoint_tenant_id"
            referencedColumnNames="id" referencedTableName="TENANT" />
        
        <addForeignKeyConstraint baseColumnNames="created_by"
            baseTableName="RUNTIME_APP_DEF" constraintName="fk_runtime_app_def_created_by"
            referencedColumnNames="id" referencedTableName="USERS" />
            
        <addForeignKeyConstraint baseColumnNames="model_id"
            baseTableName="RUNTIME_APP_DEF" constraintName="fk_runtime_app_def_model"
            referencedColumnNames="id" referencedTableName="MODEL" />
            
        <addForeignKeyConstraint baseColumnNames="user_id"
            baseTableName="STENCIL_SET_USER_FAVORITE" constraintName="fk_stencil_favorite_user_id"
            referencedColumnNames="id" referencedTableName="USERS" />
            
        <addForeignKeyConstraint baseColumnNames="stencil_set_id"
            baseTableName="STENCIL_SET_USER_FAVORITE" constraintName="fk_user_favorite_stencil"
            referencedColumnNames="id" referencedTableName="STENCIL_SET" />
            
        <addForeignKeyConstraint baseColumnNames="tenant_id"
            baseTableName="TENANT_EVENT" 
            constraintName="fk_tenant_event_tenant"
            referencedColumnNames="id" 
            referencedTableName="TENANT" />
            
        <addForeignKeyConstraint baseColumnNames="user_id"
            baseTableName="TENANT_EVENT" 
            constraintName="fk_evt_user"
            referencedColumnNames="id" 
            referencedTableName="USERS" />
            
        <addForeignKeyConstraint baseColumnNames="created_by"
            baseTableName="RELATED_CONTENT" constraintName="fk_relcont_createdby"
            referencedColumnNames="id" referencedTableName="USERS" />
        
        <addForeignKeyConstraint baseColumnNames="last_modified_by"
            baseTableName="RELATED_CONTENT" constraintName="fk_relcont_lastmodifiedby"
            referencedColumnNames="id" referencedTableName="USERS" />
            
        <addForeignKeyConstraint baseColumnNames="app_user"
            baseTableName="RUNTIME_APP" constraintName="fk_runtime_app_user"
            referencedColumnNames="id" referencedTableName="USERS" />
            
        <addForeignKeyConstraint baseColumnNames="app_definition"
            baseTableName="RUNTIME_APP" constraintName="fk_runtime_app_def"
            referencedColumnNames="id" referencedTableName="RUNTIME_APP_DEF" />
            
        <addForeignKeyConstraint baseColumnNames="user_id"
            baseTableName="REPORT_DEFINITION" constraintName="fk_report_user"
            referencedColumnNames="id" referencedTableName="USERS" />
            
        <addForeignKeyConstraint baseColumnNames="content_id"
            baseTableName="CONTENT_RENDITION" constraintName="fk_cont_rend_content"
            referencedColumnNames="id" referencedTableName="RELATED_CONTENT" />
        
	</changeSet>
    
    <changeSet id="1.1" author="activiti" dbms="mssql">
    
        <dropDefaultValue columnDataType="boolean"
                columnName="temporary"
                tableName="RELATED_CONTENT"/>
                
    </changeSet>
    
    <changeSet id="2" author="tijsrademakers">
        
        <dropColumn columnName="temporary" tableName="RELATED_CONTENT" />
        <dropColumn columnName="preview_status" tableName="RELATED_CONTENT" />
        <dropColumn columnName="thumbnail_status" tableName="RELATED_CONTENT" />
        
    </changeSet>
    
    <changeSet id="3" author="tijsrademakers">
        
        <addColumn tableName="MODEL_SHARE_INFO">
            <column name="group_id" type="bigint">
                <constraints nullable="true" />
            </column>
        </addColumn>
        
        <createIndex indexName="idx_mod_share_group" tableName="MODEL_SHARE_INFO" unique="false">
            <column name="group_id" />
        </createIndex>
        
        <addColumn tableName="STENCIL_SET_SHARE_INFO">
            <column name="group_id" type="bigint">
                <constraints nullable="true" />
            </column>
        </addColumn>
        
        <createIndex indexName="idx_stencil_share_group" tableName="STENCIL_SET_SHARE_INFO" unique="false">
            <column name="group_id" />
        </createIndex>
        
    </changeSet>
    
    <changeSet id="4" author="activiti">
    	
    	<!-- varchar(2000) to varchar(225), so it can be indexed -->
    	 <modifyDataType
            columnName="external_id"
            newDataType="varchar(255)"
            tableName="USERS"/>
         <createIndex indexName="idx_user_ext_id" tableName="USERS" unique="false">
            <column name="external_id" />
        </createIndex>   
        
        <!-- Original source dn -->
        <addColumn tableName="USERS">
            <column name="external_original_src" type="varchar(2000)" />
        </addColumn>
    
    </changeSet>
    
    <changeSet id="5" author="activiti">
	
		<!-- MODEL RELATION -->
		
		 <createTable tableName="MODEL_RELATION">
		 	<column name="id" type="bigint">
                <constraints primaryKey="true" nullable="false" />
            </column>
            <column name="parent_model_id" type="bigint" />
            <column name="model_id" type="bigint" />
            <column name="type" type="varchar(255)" />
        </createTable>
        
        <addForeignKeyConstraint baseColumnNames="parent_model_id"
			baseTableName="MODEL_RELATION" constraintName="fk_relation_parent"
			referencedColumnNames="id" referencedTableName="MODEL" />
			
		<addForeignKeyConstraint baseColumnNames="model_id"
			baseTableName="MODEL_RELATION" constraintName="fk_relation_child"
			referencedColumnNames="id" referencedTableName="MODEL" />
			
       	<!-- APP MODEL RELATION -->
   		
   		<createTable tableName="APP_RELATION">
		 	<column name="id" type="bigint">
                <constraints primaryKey="true" nullable="false" />
            </column>
            <column name="runtime_app_id" type="bigint" />
            <column name="model_id" type="bigint" />
            <column name="type" type="varchar(255)" />
        </createTable>
        
        <addForeignKeyConstraint baseColumnNames="runtime_app_id"
			baseTableName="APP_RELATION" constraintName="fk_app_relation_app"
			referencedColumnNames="id" referencedTableName="RUNTIME_APP_DEPLOYMENT" />
			
		<addForeignKeyConstraint baseColumnNames="model_id"
			baseTableName="APP_RELATION" constraintName="fk_app_relation_model"
			referencedColumnNames="id" referencedTableName="MODEL_HISTORY" />					
			
	</changeSet>
	
	<changeSet id="6" author="yvoswillens">
	
		<!-- ENDPOINTS BASIC AUTH -->
	
		<createTable tableName="ENDPOINT_BASIC_AUTH">
			<column name="id" type="bigint">
				<constraints primaryKey="true" nullable="false" />
			</column>
			<column name="tenant_id" type="bigint" />
			<column name="name" type="varchar(400)" />
			<column name="created" type="datetime">
				<constraints nullable="true" />
			</column>
			<column name="created_by" type="bigint">
				<constraints nullable="true" />
			</column>
			<column name="last_updated" type="datetime">
				<constraints nullable="true" />
			</column>
			<column name="last_updated_by" type="bigint">
				<constraints nullable="true" />
			</column>
			<column name="username" type="varchar(100)">
				<constraints nullable="true" />
			</column>
			<column name="password" type="varchar(100)">
				<constraints nullable="true" />
			</column>
			<column name="deleted" type="datetime">
				<constraints nullable="true" />
			</column>
			<column name="deleted_by" type="bigint">
				<constraints nullable="true" />
			</column>
		</createTable>
	
		<createIndex tableName="ENDPOINT_BASIC_AUTH" indexName="idx_endp_basic_auth_tenant">
			<column name="tenant_id" />
		</createIndex>
	
		<!-- ENDPOINTS CONFIGURATION -->
	
		<createTable tableName="ENDPOINT_CONFIGURATION">
			<column name="id" type="bigint">
				<constraints primaryKey="true" nullable="false" />
			</column>
			<column name="tenant_id" type="bigint" />
			<column name="name" type="varchar(400)" />
			<column name="created" type="datetime">
				<constraints nullable="true" />
			</column>
			<column name="created_by" type="bigint">
				<constraints nullable="true" />
			</column>
			<column name="last_updated" type="datetime">
				<constraints nullable="true" />
			</column>
			<column name="last_updated_by" type="bigint">
				<constraints nullable="true" />
			</column>
			<column name="protocol" type="varchar(5)">
				<constraints nullable="true" />
			</column>
			<column name="host" type="varchar(400)">
				<constraints nullable="true" />
			</column>
			<column name="port" type="varchar(5)">
				<constraints nullable="true" />
			</column>
			<column name="path" type="varchar(400)">
				<constraints nullable="true" />
			</column>
			<column name="basic_auth" type="bigint">
				<constraints nullable="true" />
			</column>
			<column name="deleted" type="datetime">
				<constraints nullable="true" />
			</column>
			<column name="deleted_by" type="bigint">
				<constraints nullable="true" />
			</column>
		</createTable>
	
		<createIndex tableName="ENDPOINT_CONFIGURATION" indexName="idx_endp_conf_tenant">
			<column name="tenant_id" />
		</createIndex>
	
		<addForeignKeyConstraint baseColumnNames="basic_auth"
			baseTableName="ENDPOINT_CONFIGURATION" constraintName="fk_basic_auth"
			referencedColumnNames="id" referencedTableName="ENDPOINT_BASIC_AUTH" />			
	</changeSet>
	
	<changeSet id="7" author="activiti">
	
		<addColumn tableName="APP_RELATION">
			<column name="metadata" type="longtext" />
		</addColumn>
		
	</changeSet>
    
    <changeSet id="8" author="activiti">
    
        <renameColumn tableName="MODEL_RELATION" 
            oldColumnName="type" 
            newColumnName="relation_type" 
            columnDataType="varchar(255)" />
            
        <renameColumn tableName="APP_RELATION" 
            oldColumnName="type" 
            newColumnName="relation_type" 
            columnDataType="varchar(255)" />
        
    </changeSet>
    
    <changeSet id="9" author="activiti">
    
        <addColumn tableName="RUNTIME_APP_DEF">
            <column name="tenant_id" type="bigint" />
       </addColumn>
        
    </changeSet>
    
    <changeSet id="10" author="activiti" dbms="mysql,postgresql,mssql,oracle,h2">
    
        <renameColumn tableName="ENDPOINT_CONFIGURATION" 
            oldColumnName="path" 
            newColumnName="pathuri" 
            columnDataType="varchar(400)" />
            
    </changeSet>
    
    <changeSet id="10.1" author="activiti" dbms="db2">
    
        <addColumn tableName="ENDPOINT_CONFIGURATION">
            <column name="pathuri" type="varchar(400)" />
        </addColumn>
        
    </changeSet>
    
    <changeSet id="11" author="activiti">
    
        <createTable tableName="SAVED_FORM">
            <column name="id" type="bigint">
                <constraints primaryKey="true" nullable="false" />
            </column>
            <column name="form_id" type="bigint">
                <constraints nullable="true" />
            </column>
            <column name="task_id" type="varchar(255)">
                <constraints nullable="true" />
            </column>
            <column name="process_id" type="varchar(255)">
                <constraints nullable="true" />
            </column>
            <column name="saved_date_time" type="timestamp(6)" />
            <column name="saved_by" type="bigint">
                <constraints nullable="true" />
            </column>
            <column name="fields_value_definition" type="longtext">
                <constraints nullable="true" />
            </column>
        </createTable>
        
        <createIndex indexName="idx_savedform_form_id"
            tableName="SAVED_FORM" unique="false">
            <column name="form_id" />
        </createIndex>
        
        <createIndex indexName="idx_savedform_task_id"
            tableName="SAVED_FORM" unique="false">
            <column name="task_id" />
        </createIndex>
    
    </changeSet>
    
    <changeSet id="12" author="activiti">
    
    	<createTable tableName="GROUP_RELATION">
             <column name="group_id" type="bigint" />
             <column name="related_group_id" type="bigint" />
             <column name="type" type="varchar(255)" />
        </createTable>
        
        <addForeignKeyConstraint baseColumnNames="group_id"
            baseTableName="GROUP_RELATION" 
            constraintName="fk_group_rel"
            referencedColumnNames="id" 
            referencedTableName="GROUPS" />  
            
        <addForeignKeyConstraint baseColumnNames="related_group_id"
            baseTableName="GROUP_RELATION" 
            constraintName="fk_related_rel"
            referencedColumnNames="id" 
            referencedTableName="GROUPS" />  
        
    </changeSet>
    
    <changeSet id="13" author="activiti">
    	<modifyDataType columnName="token_date" newDataType="datetime(6)" tableName="PERSISTENT_TOKEN" />
    </changeSet>
    
    <changeSet id="14" author="activiti">
    
        <createTable tableName="CHECKLIST_ORDER">
            <column name="id" type="bigint">
                <constraints primaryKey="true" nullable="false" />
            </column>
            <column name="task_id" type="varchar(255)">
                <constraints nullable="true" />
            </column>
            <column name="process_id" type="varchar(255)">
                <constraints nullable="true" />
            </column>
            <column name="items_order" type="longtext">
                <constraints nullable="true" />
            </column>
        </createTable>
        
        <createIndex indexName="idx_checklist_order_task_id"
            tableName="CHECKLIST_ORDER" unique="false">
            <column name="task_id" />
        </createIndex>
        
        <createIndex indexName="idx_checklist_order_process_id"
            tableName="CHECKLIST_ORDER" unique="false">
            <column name="process_id" />
        </createIndex>
    
    </changeSet>
    
    <changeSet id="15" author="activiti">
    
        <createTable tableName="USER_FILTER">
            <column name="id" type="bigint">
                <constraints primaryKey="true" nullable="false" />
            </column>
            <column name="name" type="varchar(255)">
                <constraints nullable="true" />
            </column>
            <column name="type" type="varchar(255)">
                <constraints nullable="true" />
            </column>
            <column name="user_id" type="bigint">
                <constraints nullable="true" />
            </column>
            <column name="filter_index" type="integer">
                <constraints nullable="true" />
            </column>
            <column name="recent" type="boolean" defaultValueBoolean="false" />
            <column name="icon" type="varchar(255)">
                <constraints nullable="true" />
            </column>
            <column name="app_id" type="bigint">
                <constraints nullable="true" />
            </column>
            <column name="filter_value" type="longtext">
                <constraints nullable="true" />
            </column>
        </createTable>
        
        <createIndex indexName="idx_userfilter_user_id"
            tableName="USER_FILTER" unique="false">
            <column name="user_id" />
        </createIndex>
        
    </changeSet>

    <changeSet id="16" author="activiti">
        
        <addColumn tableName="FORM">
            <column name="stencil_set_id" type="bigint">
                <constraints nullable="true" />
            </column>
        </addColumn>
        
        <createIndex indexName="idx_form_stencil_set_id"
            tableName="FORM" unique="false">
            <column name="stencil_set_id" />
        </createIndex>
    
    </changeSet>
    
    <changeSet id="17" author="activiti">
    
        <createTable tableName="SCRIPT_FILE">
            <column name="id" type="bigint">
                <constraints primaryKey="true" nullable="false" />
            </column>
            <column name="name" type="varchar(255)">
                <constraints nullable="false" />
            </column>
            <column name="version" type="bigint">
                <constraints nullable="true" />
            </column>
            <column name="created" type="timestamp(6)" />
            <column name="created_by" type="bigint" />
            <column name="tenant_id" type="bigint">
                <constraints nullable="true"/>
            </column>
            <column name="stencil_set_id" type="bigint">
                <constraints nullable="false"/>
            </column>
            <column name="filename" type="varchar(255)">
                <constraints nullable="true" />
            </column>
            <column name="filecontent" type="longtext">
                <constraints nullable="true" />
            </column>
            <column name="script_type" type="int" />
            <column name="content_size" type="bigint" defaultValueNumeric="0" />
        </createTable>
    
        <createIndex indexName="idx_script_stencil_set_id"
            tableName="SCRIPT_FILE" unique="false">
            <column name="stencil_set_id" />
        </createIndex>
        
        <createIndex indexName="idx_script_tenant_id"
            tableName="SCRIPT_FILE" unique="false">
            <column name="tenant_id" />
        </createIndex>
        
    </changeSet>

    <changeSet id="18" author="activiti">

		<createTable tableName="DOCUMENT_TEMPLATE">
			<column name="id" type="bigint">
				<constraints primaryKey="true" nullable="false" />
			</column>
			<column name="name" type="varchar(255)">
				<constraints nullable="false" />
			</column>
			<column name="created" type="timestamp(6)" />
			<column name="created_by" type="bigint" />
			<column name="tenant_id" type="bigint" />
			<column name="model_id" type="bigint" />
			<column name="store_id" type="varchar(255)" />
			<column name="mime_type" type="varchar(255)">
				<constraints nullable="true" />
			</column>
		</createTable>
		
		<addForeignKeyConstraint baseColumnNames="tenant_id"
            baseTableName="DOCUMENT_TEMPLATE" 
            constraintName="fk_tmpl_tenant"
            referencedColumnNames="id" 
            referencedTableName="TENANT" />
            
		<addForeignKeyConstraint baseColumnNames="created_by"
            baseTableName="DOCUMENT_TEMPLATE" 
            constraintName="fk_tmpl_user"
            referencedColumnNames="id" 
            referencedTableName="USERS" />
            
        <!-- We don't create FK's for the runtime document template, this is meta data -->    
        <createTable tableName="RUNTIME_DOCUMENT_TEMPLATE">
			<column name="id" type="bigint">
				<constraints primaryKey="true" nullable="false" />
			</column>
			<column name="name" type="varchar(255)">
				<constraints nullable="false" />
			</column>
			<column name="created" type="timestamp(6)" />
			<column name="created_by" type="bigint" />
			<column name="tenant_id" type="bigint" />
			<column name="model_id" type="bigint" />
			<column name="proc_def_id" type="varchar(255)" />
			<column name="store_id" type="varchar(255)" />
			<column name="mime_type" type="varchar(255)">
				<constraints nullable="true" />
			</column>
		</createTable>    

	</changeSet>
    
    <changeSet id="19" author="activiti">
        
        <addColumn tableName="SCRIPT_FILE">
            <column name="store_id" type="varchar(255)">
                <constraints nullable="true" />
            </column>
        </addColumn>
        
        <dropColumn columnName="filecontent" tableName="SCRIPT_FILE" />
        
    </changeSet>
    
    <changeSet id="20" author="activiti">
    
        <renameColumn tableName="USER_FILTER" 
            oldColumnName="type" 
            newColumnName="filter_type" 
            columnDataType="varchar(255)" />
            
    </changeSet>

    <changeSet id="21" author="activiti">

        <addColumn tableName="ALFRESCO_ENDPOINT">
            <column name="secret" type="varchar(255)"/>
        </addColumn>

    </changeSet>

</databaseChangeLog>