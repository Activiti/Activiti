<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE chapter PUBLIC "-//OASIS//DTD DocBook XML V4.5//EN" "../../../target/docbook-tool-1.0/docbook-xml/docbookx.dtd">

<chapter>
  <title>Configuration</title>

  <para>Activiti configuration files should be generated with the setup ant script that can be found in the <emphasis>setup</emphasis> folder.
  The <literal>cfg.create</literal> target can be easily configured 
  in the <literal>setup/build.properties</literal> and the <literal>setup/build.${db}.properties</literal>.
  Our QA runs only the configurations that can be generated by the setup script.
  We also do not guarantee compatibility of the actual configuration files in future versions
  as you will always be able to regenerate it. So customizing the configuration files is 
  not recommended. 
  </para>  
  
  <section id="configurationproperties">
    <title>Configuration properties</title>
    <para>Here are the configuration properties that you can specify in the <literal>activiti.properties</literal>.
    This is only applicable if you're using the <literal>ProcessEngineBuilder</literal> directly or indirectly 
    through <literal>ProcessEngines</literal>. This is <emphasis role="bold">not</emphasis> applicable if you're 
    using <link linkend="springintegration">the Spring style of building a process engine</link>.</para>
    <itemizedlist>
      <listitem><para><emphasis role="bold">process.engine.name</emphasis>:  The process engine name.  Only relevant if you're using 
      multiple process engines in one classloading scope.
      </para></listitem>
      <listitem><para><emphasis role="bold">database</emphasis>:  one of the database names specified in <xref linkend="databasenames" /> </para></listitem>
      <listitem><para><emphasis role="bold">jdbc.driver</emphasis>, <emphasis role="bold">jdbc.url</emphasis>, <emphasis role="bold">jdbc.username</emphasis> 
      and <emphasis role="bold">jdbc.password</emphasis>:  JDBC properties pointing to the database Activiti will use.</para></listitem>
      <listitem><para><emphasis role="bold">db.schema.strategy</emphasis>: { <literal>check-version</literal> | <literal>create-drop</literal> } <literal>check-version</literal> 
      is the default and it will check if the DB version is the same as the library version when the process engine is created.  <literal>create-drop</literal> is handy for 
      testing.  It creates the DB schema when the process engine is created and drops the schema when the engine is closed.</para></listitem>
      <listitem><para><emphasis role="bold">job.executor.auto.activate</emphasis>: { <literal>enabled</literal> | <literal>disabled</literal> } <literal>enabled</literal> is the 
      default which means that the JobExecutor component will start when the process engine is created.  In testing, it's best to set this property to <literal>disabled</literal>.
      Then the job executor won't be activated and the test can manually search for jobs with <literal>ManagementService.createJobQuery</literal> and execute them 
      with <literal>ManagementService.executeJob</literal>.</para></listitem>
      <listitem><para><emphasis role="bold">mail.smtp.host</emphasis>, <emphasis role="bold">mail.smtp.port</emphasis>, <emphasis role="bold">mail.smtp.user</emphasis>, 
      <emphasis role="bold">mail.smtp.password</emphasis> and <emphasis role="bold">mail.default.from</emphasis>: SMTP properties used when Activiti needs to send email.</para></listitem>
    </itemizedlist>
  </section>
  
  <section id="supporteddatabases">
    <title>Supported databases</title>
    <para>Following are the names (case sensitive!) that Activiti uses to refer to databases.</para>
    <table id="databasenames">
      <title>Supported databases</title>
      <tgroup cols='3'>
        <thead>
          <row>
            <entry>Activiti database name</entry>
            <entry>Versions tested</entry>
            <entry>Notes</entry>
          </row>
        </thead>
        <tbody>
          <row>
            <entry><emphasis role="bold">h2</emphasis></entry>
            <entry>1.2.132</entry>
            <entry></entry>
          </row>
          <row>
            <entry>mysql</entry>
            <entry>5.1.11</entry>
            <entry></entry>
          </row>
          <row>
            <entry>oracle</entry>
            <entry>10.2.0</entry>
            <entry></entry>
          </row>
          <row>
            <entry>postgresql</entry>
            <entry></entry>
            <entry>not yet supported (coming soon)</entry>
          </row>
          <row>
            <entry>db2</entry>
            <entry></entry>
            <entry>not yet supported (coming soon)</entry>
          </row>
        </tbody>
      </tgroup>
    </table>
  </section>
    
  <section>
    <title>Changing the database</title>
    
    <para>
      One of the things you probably want to do fairly soon, is configuring Activiti to
      use a different database. To generate a configuration file that can be used
      to configure the engine, following steps need to be done:
      <itemizedlist>
        <listitem>
          <para>
            Edit <literal>setup/build.properties</literal> and change the <literal>db</literal>
            parameter to your type of database (e.g. mysql).
          </para>
        </listitem>
        <listitem>
          <para>
            Edit <literal>setup/build.${db}.properties</literal> and change the 
            JDBC connection parameters to those of your database installation.
          </para>
        </listitem>
        <listitem>
          <para>
            Run <literal>'ant cfg.create'</literal> from within the <literal>setup</literal>
            folder.
          </para>
        </listitem>
        <listitem>
          <para>
            The generate configuration file can now be found in <literal>setup/build/activiti-cfg</literal>.
            Also, for convenience, a jar called <literal>activiti-cfg.jar</literal> containing the configuration file can be found in
            <literal>setup/build</literal> 
          </para>
        </listitem>
      </itemizedlist>
    </para>
    
    <section>
    	<title>Using Oracle in the demo setup</title>
    	<para>When you want to run the demo setup using oracle as datasource, an extra step is required BEFORE you call the ant target <literal>demo.setup</literal>. 
    	  <itemizedlist>
    	    <listitem>
    	      <para>
		        Since we cannot redistribute the Oracle JDBC driver, you should download it manually: 
		    	<ulink url="http://www.oracle.com/technetwork/database/enterprise-edition/jdbc-112010-090769.html">http://www.oracle.com/technetwork/database/enterprise-edition/jdbc-112010-090769.html</ulink>.
		    	Make sure you download ojdbc5.jar, version 11.2.0.1.
    	      </para>
    	    </listitem>
    	    <listitem>
    	      <para>
    	        Copy the jar to <literal>lib/provided/</literal>
    	      </para>
    	    </listitem>
    	    <listitem>
    	      <para>
    	        The only thing left to dos is calling the folowing ant target, in the build-file located in <literal>/setup</literal>: 
    	        <programlisting>db.oracle.install.driver</programlisting>  
    	        The ant-target will actually install the jdbc-driver in the maven repository to be able to use it afterward, using the command:
    	        <programlisting>
install:install-file -Dfile=ojdbc5.jar -DgroupId=com.oracle.jdbc -DartifactId=ojdbc5 
   -Dpackaging=jar -Dversion=11.2.0.1.0 -DcreateChecksum=true -DgeneratePom=true
   				</programlisting>
    	      </para>
    	    </listitem>
    	  </itemizedlist>
    	</para>
    </section>
  </section>
  
</chapter>
